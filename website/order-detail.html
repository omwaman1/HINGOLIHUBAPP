<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Details - Hingoli Hub‚Ñ¢</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">

    <style>
        .order-detail-page {
            padding-top: 80px;
            min-height: 100vh;
            background: var(--gray-50);
        }

        .order-container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-4);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--gray-600);
            text-decoration: none;
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-4);
        }

        .order-header-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
        }

        .order-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--space-2);
        }

        .order-meta {
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
            font-size: var(--font-size-sm);
            color: var(--gray-600);
        }

        .order-status-badge {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-confirmed {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-shipped {
            background: #e0e7ff;
            color: #3730a3;
        }

        .status-delivered {
            background: #d1fae5;
            color: #065f46;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .section-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
        }

        .section-title {
            font-size: var(--font-size-base);
            font-weight: 700;
            margin-bottom: var(--space-4);
        }

        .order-items {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .order-item {
            display: flex;
            gap: var(--space-3);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid var(--gray-100);
        }

        .order-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .item-image {
            width: 70px;
            height: 70px;
            border-radius: var(--radius-md);
            object-fit: cover;
            background: var(--gray-100);
        }

        .item-details {
            flex: 1;
        }

        .item-title {
            font-weight: 600;
            margin-bottom: var(--space-1);
        }

        .item-seller {
            font-size: var(--font-size-xs);
            color: var(--gray-500);
        }

        .item-qty {
            font-size: var(--font-size-sm);
            color: var(--gray-600);
        }

        .item-price {
            font-weight: 700;
            color: var(--primary-600);
        }

        .address-box {
            background: var(--gray-50);
            border-radius: var(--radius-md);
            padding: var(--space-4);
        }

        .address-box h4 {
            font-weight: 600;
            margin-bottom: var(--space-2);
        }

        .address-box p {
            font-size: var(--font-size-sm);
            color: var(--gray-600);
            margin-bottom: var(--space-1);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-2);
            font-size: var(--font-size-sm);
        }

        .summary-row.total {
            font-size: var(--font-size-lg);
            font-weight: 700;
            border-top: 2px solid var(--gray-100);
            padding-top: var(--space-3);
            margin-top: var(--space-3);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <a href="index.html" class="logo">
                <img src="images/logo.jpg" alt="Hingoli Hub"
                    style="width: 32px; height: 32px; border-radius: 8px; object-fit: cover;">
                <span class="logo-text">Hingoli Hub‚Ñ¢</span>
            </a>

            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="listings.html?type=services">Services</a></li>
                <li><a href="listings.html?type=selling">Buy & Sell</a></li>
                <li><a href="listings.html?type=business">Businesses</a></li>
                <li><a href="listings.html?type=jobs">Jobs</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>

            <div id="authNav">
                <a href="login.html" class="btn btn-white">üë§ Login</a>
            </div>
        </nav>
    </header>

    <div class="order-detail-page">
        <div class="order-container">
            <a href="orders.html" class="back-link">‚Üê Back to Orders</a>

            <div id="orderContent">
                <div class="order-header-card">
                    <p>Loading order details...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/components.js"></script>
    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            app.initAuth();

            if (!app.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }

            const params = new URLSearchParams(window.location.search);
            const orderId = params.get('id');

            if (!orderId) {
                window.location.href = 'orders.html';
                return;
            }

            await loadOrderDetail(orderId);
        });

        async function loadOrderDetail(orderId) {
            try {
                const response = await api.getOrderById(orderId);

                if (response.success && response.data) {
                    renderOrder(response.data);
                } else {
                    document.getElementById('orderContent').innerHTML = '<p>Order not found</p>';
                }
            } catch (error) {
                document.getElementById('orderContent').innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        function renderOrder(order) {
            const date = new Date(order.created_at).toLocaleDateString('en-IN', {
                day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit'
            });

            const statusClass = `status-${order.order_status}`;

            const itemsHtml = order.items.map(item => `
                <div class="order-item">
                    <img src="${item.main_image_url || 'https://via.placeholder.com/70'}" 
                         alt="${item.title}" class="item-image"
                         onerror="this.src='https://via.placeholder.com/70?text=No+Image'">
                    <div class="item-details">
                        <div class="item-title">${item.title}</div>
                        <div class="item-seller">Sold by: ${item.seller_name}</div>
                        <div class="item-qty">Qty: ${item.quantity}</div>
                    </div>
                    <div class="item-price">‚Çπ${components.formatPrice(item.price * item.quantity)}</div>
                </div>
            `).join('');

            const html = `
                <div class="order-header-card">
                    <h1 class="order-title">Order #${order.order_number}</h1>
                    <div class="order-meta">
                        <span>üìÖ ${date}</span>
                        <span class="order-status-badge ${statusClass}">${order.order_status.toUpperCase()}</span>
                    </div>
                    ${order.delivery_message ? `<p style="margin-top: var(--space-3); color: var(--success);">üöö ${order.delivery_message}</p>` : ''}
                </div>

                <div class="section-card">
                    <h2 class="section-title">üì¶ Items</h2>
                    <div class="order-items">
                        ${itemsHtml}
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">üìç Delivery Address</h2>
                    <div class="address-box">
                        <h4>${order.address.name}</h4>
                        <p>${order.address.address_line1}${order.address.address_line2 ? ', ' + order.address.address_line2 : ''}</p>
                        <p>${order.address.city}, ${order.address.state} - ${order.address.pincode}</p>
                        <p>üìû ${order.address.phone}</p>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">üí≥ Payment</h2>
                    <div class="summary-row">
                        <span>Payment Method</span>
                        <span>${order.payment_method === 'razorpay' ? 'Online Payment' : 'Cash on Delivery'}</span>
                    </div>
                    <div class="summary-row">
                        <span>Payment Status</span>
                        <span style="color: ${order.payment_status === 'paid' ? 'var(--success)' : 'var(--warning)'}">
                            ${order.payment_status.toUpperCase()}
                        </span>
                    </div>
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span>‚Çπ${components.formatPrice(order.subtotal)}</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping</span>
                        <span>‚Çπ${components.formatPrice(order.shipping_fee)}</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span>‚Çπ${components.formatPrice(order.total_amount)}</span>
                    </div>
                </div>
            `;

            document.getElementById('orderContent').innerHTML = html;
            document.title = `Order #${order.order_number} - Hingoli Hub‚Ñ¢`;
        }
    </script>
</body>

</html>